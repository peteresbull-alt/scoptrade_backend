{% extends "dashboard/base.html" %}
{% block title %}Users - ScopTrade Admin{% endblock %}
{% block page_title %}Manage Users{% endblock %}

{% block content %}
<!-- Search & Filter -->
<div class="bg-white rounded-xl border border-gray-200/60 p-4 mb-6">
    <form method="get" class="flex flex-col sm:flex-row gap-3">
        <div class="relative flex-1">
            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
            <input type="text" name="search" value="{{ search_query }}" placeholder="Search by email, name, or account IDâ€¦"
                class="w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        </div>
        <select name="status" class="px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500">
            <option value="">All Users</option>
            <option value="verified" {% if filter_status == 'verified' %}selected{% endif %}>Verified</option>
            <option value="unverified" {% if filter_status == 'unverified' %}selected{% endif %}>Unverified</option>
            <option value="kyc_pending" {% if filter_status == 'kyc_pending' %}selected{% endif %}>KYC Pending</option>
        </select>
        <button type="submit" class="px-5 py-2.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-500 transition">Filter</button>
    </form>
</div>

<!-- Users Table -->
<div class="bg-white rounded-xl border border-gray-200/60 overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full text-sm min-w-[800px]">
            <thead><tr class="bg-gray-50 text-left text-xs text-gray-500 uppercase">
                <th class="px-5 py-3">User</th>
                <th class="px-5 py-3">Account ID</th>
                <th class="px-5 py-3">Balance</th>
                <th class="px-5 py-3">Profit</th>
                <th class="px-5 py-3">Status</th>
                <th class="px-5 py-3">Joined</th>
                <th class="px-5 py-3">Actions</th>
            </tr></thead>
            <tbody class="divide-y divide-gray-100">
            {% for u in users %}
            <tr class="hover:bg-gray-50">
                <td class="px-5 py-3">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 text-xs font-bold shrink-0">{{ u.email|first|upper }}</div>
                        <span class="truncate max-w-[200px]">{{ u.email }}</span>
                    </div>
                </td>
                <td class="px-5 py-3 text-gray-500 font-mono text-xs">{{ u.account_id }}</td>
                <td class="px-5 py-3 font-medium">${{ u.balance|floatformat:2 }}</td>
                <td class="px-5 py-3 {% if u.profit > 0 %}text-emerald-600{% elif u.profit < 0 %}text-red-600{% else %}text-gray-400{% endif %}">${{ u.profit|floatformat:2 }}</td>
                <td class="px-5 py-3">
                    <div class="flex items-center gap-1.5">
                        {% if u.is_verified %}<span class="px-2 py-0.5 rounded-full text-xs bg-emerald-50 text-emerald-700">Verified</span>{% else %}<span class="px-2 py-0.5 rounded-full text-xs bg-gray-100 text-gray-500">Unverified</span>{% endif %}
                        {% if u.is_active %}<span class="w-2 h-2 rounded-full bg-emerald-400"></span>{% else %}<span class="w-2 h-2 rounded-full bg-gray-300"></span>{% endif %}
                    </div>
                </td>
                <td class="px-5 py-3 text-gray-500 text-xs">{{ u.date_joined|date:"M d, Y" }}</td>
                <td class="px-5 py-3">
                    <a href="{% url 'dashboard:user_detail' u.id %}" class="px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-lg text-xs font-medium hover:bg-indigo-100 transition">View</a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="7" class="px-5 py-12 text-center text-gray-400">No users found</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% include "dashboard/pagination.html" %}
{% endblock %}
